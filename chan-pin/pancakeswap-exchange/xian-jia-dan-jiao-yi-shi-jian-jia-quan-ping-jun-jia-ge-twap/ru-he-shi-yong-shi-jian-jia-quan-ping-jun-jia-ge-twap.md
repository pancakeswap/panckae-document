# 如何使用时间加权平均价格（TWAP）？

## 什么是 TWAP？

&#x20;TWAP（时间加权平均价）是 CeFi 中使用的一种常见订单类型，它将订单分解成较小的交易量，并在固定的时间间隔内执行。TWAP 订单的主要目的是减少订单的价格影响。如果用户想执行平均美元成本策略（DCA），并按一致的时间间隔（即每月一次）买入某种代币，那么 TWAP 订单也很有用。&#x20;

因此，当订单规模与可用流动性相比较大时，或当用户预计价格波动较大且没有明确的上涨或下跌趋势时，最好使用 TWAP。

## 如何设置 TWAP 订单？&#x20;

1. 进入 "兑换 "页面，点击 TWAP 选择 TWAP 订单选项&#x20;
2. 选择 "支出 "和 "接收 "的代币种类，并输入您希望交易的金额。&#x20;
3. 用户界面可启用 dTWAP-市场订单和 dTWAP-限价订单，前者以可用市场价格执行所有交易，后者仅在用户设置的价格限制范围内执行单笔交易。 在本例中，我们选择以市场价格执行 TWAP 订单。&#x20;
4. 接下来，我们指定 TWAP 参数。有 3 个主要参数可以控制 dTWAP 订单的有效性：&#x20;
   1. 交易总数： 允许用户指定其订单将被分解成的单个交易数量。用户界面滑块从 1 笔交易开始，允许用户增加单笔交易的数量，或允许用户直接在输入栏中手动输入总交易量。 用户应注意，在指定该参数时需要进行一定的权衡：更多的交易意味着更小的单笔交易规模，这意味着对价格的影响更小。但是，更多的交易也意味着更多的交易和更高的总体 gas 费用。
   2. 交易间隔： 设置每笔交易之间的时间间隔。用户界面从允许的最小值（2 分钟）开始，这为每笔交易之间的竞价和区块结算留出了最短时间。用户可以将其设置为任何所需的时间。在上一笔交易结束后的这段时间内，交易永远不会执行。用户在设置该参数时应再次注意：较长的时间间隔将允许套利者有更长的时间来消除受池子影响的价格差异，并使池子恢复平衡（与现货价格持平）。但是，订单成交需要更长的时间，这将增加最终成交价格的不确定性，尤其是在波动加剧的时候。
   3. 最大持续时间： 可执行构成完整 dTWAP 订单的所有单笔交易总金额的最长时间。超过此期限后，无论交易金额多少，交易都将失效。 请注意，限价订单可能无法执行所有分块，这取决于价格是否保持在设定参数范围内。 默认建议持续时间的计算方法是：间隔数乘以交易间隔，然后将此金额加倍，以作为缓冲，为链上有效的活动留出足够的时间。(注意，设置比上述默认值短的持续时间可能会导致部分订单成交）。

可以看出，考虑到市场条件、当前 gas 费用等因素，这些参数为定制每个订单提供了极大的灵活性。

5. 点击 "Place order"。仔细检查订单详情，接受免责声明，然后点击 " Confirm order"。&#x20;
6. 交易处理完毕后，您可以在订单历史记录部分的 "未结订单 "下查看订单状态。&#x20;
7. 您可以随时展开订单并点击 "取消订单 "按钮取消未结订单。

注意事项:

* 由于订单在指定时间内以较小的交易量执行，因此受到市场条件和其他风险的影响。&#x20;
* 您的交易执行价格可能与当前市场价格相差很大（尽管不会低于您设定的限价），这可能会导致重大损失。如果现有市场价格低于您设定的限价，您订单中的部分交易可能无法执行，导致订单部分成交。
* &#x20;交易以分散协议为基础，利用链外吃单者竞争来完成订单。这些吃单者有权要求支付费用，协议会从输出代币中为获胜的接盘者扣除费用。
* 吃单方在设定费用时可能会考虑到您交易的 gas 费用，这可能会导致费用金额的波动。
